<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>Editar Empreendimento #{{ empreendimento.id }} | Bresolin</title>
    <link rel="icon" href="/static/img/icons/favicon_bresolin_rounded.png" type="image/png">
    
    <link rel="stylesheet" href="/static/css/editar_empreendimento.css">
    <!-- SortableJS para Drag and Drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>

<body>

    <header>
        <button class="btn-voltar" onclick="history.back()">
            <img src="/static/img/icons/icons8-back-arrow-100.svg" alt="Voltar">
        </button>
        <h1>Editar Empreendimento</h1>
    </header>

    <main class="conteudo-empreendimento">
        <form id="form-editar-empreendimento" class="form-grid">
            <input type="hidden" name="id" value="{{ empreendimento.id }}">

            <!-- Coluna Esquerda -->
            <div class="col-main">
                <!-- Card: Dados Básicos -->
                <div class="card-section">
                    <h2>Dados Básicos</h2>
                    <div class="form-group">
                        <label for="nome">Nome do Empreendimento</label>
                        <input type="text" id="nome" name="nome" value="{{ empreendimento.nome }}" required class="input-full">
                    </div>
                    <div class="form-group">
                        <label for="descricao">Descrição</label>
                        <textarea id="descricao" name="descricao" class="input-full">{{ empreendimento.descricao }}</textarea>
                    </div>
                </div>

                <!-- Card: Localização -->
                <div class="card-section">
                    <h2>Localização</h2>
                    <div class="form-group">
                        <label for="endereco_completo">Endereço Completo</label>
                        <input type="text" id="endereco_completo" name="endereco_completo" value="{{ empreendimento.endereco_completo or '' }}">
                    </div>
                    <div class="form-group">
                        <label for="bairro">Bairro</label>
                        <input type="text" id="bairro" name="bairro" value="{{ empreendimento.bairro or '' }}">
                    </div>
                    <div class="row-2">
                        <div class="form-group">
                            <label for="cidade">Cidade</label>
                            <input type="text" id="cidade" name="cidade" value="{{ empreendimento.cidade or '' }}">
                        </div>
                        <div class="form-group">
                            <label for="uf">UF</label>
                            <input type="text" id="uf" name="uf" maxlength="2" value="{{ empreendimento.uf or '' }}" class="input-short">
                        </div>
                    </div>
                </div>

                <!-- Card: Mídia -->
                <div class="card-section">
                    <h2>Mídia</h2>
                    <div class="form-group">
                        <label>Imagem Principal</label>
                        <div class="image-upload-area">
                             {% if empreendimento.imagem %}
                            <img id="preview-imagem-principal" src="{{ empreendimento.imagem }}" class="preview-main">
                            {% else %}
                            <img id="preview-imagem-principal" class="preview-main" style="display: none;">
                            <div class="placeholder-text">Nenhuma imagem selecionada</div>
                            {% endif %}
                            <input type="file" id="file-imagem-principal" accept="image/*" class="file-input">
                            <input type="hidden" name="imagem" id="input-imagem-principal" value="{{ empreendimento.imagem or '' }}">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Imagens Secundárias</label>
                        <input type="file" id="file-secundarias-emp-edit" multiple accept="image/*" class="file-input-secondary">
                        <div id="lista-secundarias-emp-edit" class="galeria-preview">
                            <!-- Imagens existentes serão carregadas via JavaScript -->
                        </div>
                        <button type="button" id="btn-excluir-secundarias-emp" class="btn-small btn-danger">Excluir selecionadas</button>
                        <small class="help-text">Selecione múltiplas imagens para adicionar à galeria do empreendimento</small>
                    </div>
                </div>

                <!-- Card: Seleção de Imóveis -->
                <div class="card-section">
                    <h2>Unidades do Empreendimento</h2>
                    <div class="grupo-imoveis-empreendimento">
                        <div class="imoveis-selection-container">
                            <div class="imoveis-list">
                                <h4>Disponíveis</h4>
                                <select id="imoveis-disponiveis" multiple size="8">
                                    <!-- Preenchido via JavaScript -->
                                </select>
                            </div>
                            <div class="imoveis-controls">
                                <button type="button" id="btn-adicionar-imovel">→</button>
                                <button type="button" id="btn-remover-imovel">←</button>
                            </div>
                            <div class="imoveis-list">
                                <h4>Selecionados</h4>
                                <select id="imoveis-selecionados" name="imoveis_ids[]" multiple size="8">
                                    <!-- Imóveis selecionados -->
                                </select>
                            </div>
                        </div>
                        <small class="help-text">Selecione os imóveis que fazem parte deste empreendimento</small>
                    </div>
                </div>
            </div>

            <!-- Coluna Direita -->
            <div class="col-sidebar">
                 <!-- Card: Ações -->
                 <div class="card-section sticky-card">
                    <button type="submit" class="btn-save">Salvar Alterações</button>
                </div>

                <!-- Card: Estágio e Datas -->
                <div class="card-section">
                    <h2>Estágio e Datas</h2>
                    <div class="form-group">
                        <label for="estagio">Estágio da obra</label>
                        <select id="estagio" name="estagio">
                            <option value="">Selecione</option>
                            <option value="LANÇAMENTO" {% if empreendimento.estagio=='LANÇAMENTO' %}selected{% endif %}>LANÇAMENTO</option>
                            <option value="EM CONSTRUÇÃO" {% if empreendimento.estagio=='EM CONSTRUÇÃO' %}selected{% endif %}>EM CONSTRUÇÃO</option>
                            <option value="PRONTO" {% if empreendimento.estagio=='PRONTO' %}selected{% endif %}>PRONTO</option>
                            <option value="ENTREGUE" {% if empreendimento.estagio=='ENTREGUE' %}selected{% endif %}>ENTREGUE</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lancamento">Lançamento</label>
                        <input type="text" id="lancamento" name="lancamento" value="{{ empreendimento.lancamento or '' }}">
                    </div>
                    <div class="form-group">
                        <label for="entrega">Previsão de Entrega</label>
                        <input type="text" id="entrega" name="entrega" value="{{ empreendimento.entrega or '' }}">
                    </div>
                </div>

                <!-- Card: Características -->
                <div class="card-section">
                    <h2>Características</h2>
                    <div class="grid-2">
                         <div class="form-group">
                            <label for="total_unidades">Total Unidades</label>
                            <input type="number" id="total_unidades" name="total_unidades" value="{{ empreendimento.total_unidades or '' }}">
                        </div>
                        <div class="form-group">
                            <label for="n_andares">Nº Andares</label>
                            <input type="number" id="n_andares" name="n_andares" value="{{ empreendimento.n_andares or '' }}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="area_laje">Área da Laje (m²)</label>
                        <input type="number" id="area_laje" name="area_laje" step="0.01" value="{{ empreendimento.area_laje or '' }}">
                    </div>
                </div>

                <!-- Card: Faixa de Preços e Áreas -->
                <div class="card-section">
                    <h2>Preços e Áreas</h2>
                    <div class="row-2">
                        <div class="form-group">
                            <label for="preco_minimo">Preço Mín.</label>
                            <input type="number" id="preco_minimo" name="preco_minimo" step="0.01" value="{{ empreendimento.preco_minimo or '' }}">
                        </div>
                        <div class="form-group">
                            <label for="preco_maximo">Preço Máx.</label>
                            <input type="number" id="preco_maximo" name="preco_maximo" step="0.01" value="{{ empreendimento.preco_maximo or '' }}">
                        </div>
                        <div class="form-group">
                            <label for="area_minima">Área Mín.</label>
                            <input type="number" id="area_minima" name="area_minima" step="0.01" value="{{ empreendimento.area_minima or '' }}">
                        </div>
                        <div class="form-group">
                            <label for="area_maxima">Área Máx.</label>
                            <input type="number" id="area_maxima" name="area_maxima" step="0.01" value="{{ empreendimento.area_maxima or '' }}">
                        </div>
                    </div>
                </div>

                 <!-- Card: Quartos e Vagas -->
                 <div class="card-section">
                    <h2>Configurações</h2>
                    <div class="row-2">
                        <div class="form-group">
                            <label for="quartos_minimo">Quartos Mín.</label>
                            <input type="number" id="quartos_minimo" name="quartos_minimo" value="{{ empreendimento.quartos_minimo or '' }}">
                        </div>
                        <div class="form-group">
                            <label for="quartos_maximo">Quartos Máx.</label>
                            <input type="number" id="quartos_maximo" name="quartos_maximo" value="{{ empreendimento.quartos_maximo or '' }}">
                        </div>
                         <div class="form-group">
                            <label for="vagas_minimo">Vagas Mín.</label>
                            <input type="number" id="vagas_minimo" name="vagas_minimo" value="{{ empreendimento.vagas_minimo or '' }}">
                        </div>
                        <div class="form-group">
                            <label for="vagas_maximo">Vagas Máx.</label>
                            <input type="number" id="vagas_maximo" name="vagas_maximo" value="{{ empreendimento.vagas_maximo or '' }}">
                        </div>
                    </div>
                </div>

                <!-- Card: Documentação -->
                <div class="card-section">
                    <h2>Documentação</h2>
                    <div class="form-group">
                        <label for="ri">R.I. (Registro)</label>
                        <input type="text" id="ri" name="ri" value="{{ empreendimento.ri or '' }}">
                    </div>
                    <div class="form-group">
                        <label for="iptu">IPTU</label>
                        <input type="number" id="iptu" name="iptu" step="0.01" value="{{ empreendimento.iptu or '' }}">
                    </div>
                </div>

            </div>
        </form>
    </main>

    <script src="/static/js/editar_empreendimento.js"></script>
</body>

</html>